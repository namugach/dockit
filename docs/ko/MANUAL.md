# Dockit 사용자 메뉴얼

이 문서는 Dockit의 자세한 사용 방법을 설명합니다.

## 목차

1. [소개](#소개)
2. [설치](#설치)
3. [명령어](#명령어)
    - [init](#init---초기화)
    - [start](#start---컨테이너-시작)
    - [build](#build---Docker-이미지-빌드)
    - [up](#up---백그라운드에서-컨테이너-시작)
    - [stop](#stop---컨테이너-정지)
    - [down](#down---컨테이너-제거)
    - [connect](#connect---컨테이너-접속)
    - [status](#status---상태-확인)
    - [migrate](#migrate---버전-업그레이드)
    - [setup](#setup---전체-환경-설정)
    - [run](#run---자동-실행)
    - [join](#join---자동-실행-및-접속)
    - [ps](#ps---컨테이너-목록)
    - [help](#help---도움말)
4. [설정 파일](#설정-파일)
5. [문제 해결](#문제-해결)

## 소개

Dockit은 Docker를 사용하여 개발 환경을 빠르게 설정하고 관리하기 위한 모듈식 쉘 스크립트 도구입니다. 이 도구는 Docker 컨테이너를 통해 일관된 개발 환경을 제공하며, 다양한 운영체제에서 동일한 환경을 구성할 수 있도록 도와줍니다.

Dockit의 주요 목표는 다음과 같습니다:
- 개발 환경 설정의 복잡성 감소
- 일관된 개발 환경 제공
- 개발 설정의 이식성 향상
- 팀 작업을 위한 표준화된 환경 구성

## 설치

### 요구 사항

- Docker가 설치되어 있어야 합니다.
- Bash 쉘 환경이 필요합니다.

### 설치 방법

Dockit을 설치하려면 다음 명령어를 실행하세요:

```bash
# 저장소 복제
git clone https://github.com/namugach/dockit.git
cd dockit

# 설치 스크립트 실행
./bin/install.sh
```

이 명령어는 Dockit을 시스템에 설치하고 쉘 환경에 필요한 경로를 추가합니다.
설치 후에는 어떤 디렉토리에서든 `dockit` 명령을 사용할 수 있습니다.

### 제거하기

Dockit을 시스템에서 제거하려면:

```bash
./bin/uninstall.sh
```

## 명령어

Dockit은 다음과 같은 명령어를 제공합니다:

### init - 초기화

Docker 개발 환경을 초기화하고 설정합니다.

```bash
dockit init
```

이 명령어는 다음 작업을 수행합니다:
- `.dockit_project` 디렉토리 생성
- 사용자 설정 정보 수집
- Docker 이미지 빌드
- docker-compose.yml 파일 생성

초기화 과정에서는 다음 정보를 설정할 수 있습니다:
- 사용자 이름
- UID/GID
- 비밀번호
- 작업 디렉토리
- 이미지 이름
- 컨테이너 이름

### Start 명령어

`start` 명령어는 컨테이너를 시작하는 데 사용됩니다. 컨테이너가 존재하지 않는 경우 자동으로 생성하고 시작할 수 있는 옵션을 제공합니다.

사용법:
```bash
dockit start [옵션]
```

옵션:
- (인자 없음): 사용 가능한 컨테이너 목록 표시
- `number`: 목록에서 지정된 번호의 컨테이너 시작
- `"this"`: 현재 프로젝트 디렉토리의 컨테이너 시작
- `"all"`: 모든 dockit 컨테이너 시작

**자동 생성 기능:**
컨테이너가 존재하지 않는 경우 다음과 같이 묻습니다:
- "컨테이너가 존재하지 않습니다. 컨테이너를 생성하고 시작하시겠습니까? (Y/n)"
- 'Y'를 선택하면 자동으로 `dockit up`을 실행하여 컨테이너를 생성하고 시작합니다
- 'n'을 선택하면 작업이 취소됩니다

예제:
```bash
dockit start           # 컨테이너 목록 표시
dockit start 1         # 1번 컨테이너 시작 (없으면 생성)
dockit start 1 2 3     # 1, 2, 3번 컨테이너 시작
dockit start this      # 현재 프로젝트 컨테이너 시작 (없으면 생성)
dockit start all       # 모든 dockit 컨테이너 시작
```

### build - Docker 이미지 빌드

개발 환경용 Docker 이미지를 빌드합니다.

```bash
dockit build
```

이 명령어는 다음 작업을 수행합니다:
- 템플릿으로부터 임시 Dockerfile 생성
- 베이스 이미지 및 사용자 설정 구성
- 적절한 설정으로 Docker 이미지 빌드
- 개발 환경 이미지를 리빌드하거나 업데이트해야 할 때 유용함

### Up 명령어

컨테이너를 접속 프롬프트 없이 백그라운드에서 시작합니다.

사용법:
```bash
dockit up [옵션]
```

옵션:
- (인자 없음): 사용 가능한 컨테이너 목록 표시
- `number`: 목록에서 지정된 번호의 컨테이너 시작
- `"this"`: 현재 프로젝트 디렉토리의 컨테이너 시작
- `"all"`: 모든 dockit 컨테이너 시작

이 명령어는 다음 작업을 수행합니다:
- Docker Compose를 사용하여 분리 모드(detached mode)로 컨테이너 시작
- 컨테이너 접속 여부를 묻지 않음
- 컨테이너 상태 정보 표시
- 자동화 스크립트나 즉시 접속이 필요 없을 때 유용함

예제:
```bash
dockit up             # 컨테이너 목록 표시
dockit up 1           # 1번 컨테이너 시작
dockit up 1 2 3       # 1, 2, 3번 컨테이너 시작
dockit up this        # 현재 프로젝트 컨테이너 시작
dockit up all         # 모든 dockit 컨테이너 시작
```

### Stop 명령어

`stop` 명령어는 실행 중인 컨테이너를 중지하는 데 사용됩니다. 이 명령어는 컨테이너 상태를 유지합니다.

사용법:
```bash
dockit stop [옵션]
```

옵션:
- (인자 없음): 사용 가능한 컨테이너 목록 표시
- `number`: 목록에서 지정된 번호의 컨테이너 중지
- `"this"`: 현재 프로젝트 디렉토리의 컨테이너 중지
- `"all"`: 모든 dockit 컨테이너 중지

예제:
```bash
dockit stop           # 컨테이너 목록 표시
dockit stop 1         # 1번 컨테이너 중지
dockit stop 1 2 3     # 1, 2, 3번 컨테이너 중지
dockit stop this      # 현재 프로젝트 컨테이너 중지
dockit stop all       # 모든 dockit 컨테이너 중지
```

### Down 명령어

컨테이너를 완전히 제거합니다.

사용법:
```bash
dockit down [옵션]
```

옵션:
- (인자 없음): 사용 가능한 컨테이너 목록 표시
- `number`: 목록에서 지정된 번호의 컨테이너 제거
- `"this"`: 현재 프로젝트 디렉토리의 컨테이너 제거
- `"all"`: 모든 dockit 컨테이너 제거

이 명령어는 컨테이너를 중지하고 제거합니다. 컨테이너 내부에 저장된 모든 데이터가 삭제되므로 주의해서 사용해야 합니다.

예제:
```bash
dockit down           # 컨테이너 목록 표시
dockit down 1         # 1번 컨테이너 제거
dockit down 1 2 3     # 1, 2, 3번 컨테이너 제거
dockit down this      # 현재 프로젝트 컨테이너 제거
dockit down all       # 모든 dockit 컨테이너 제거
```

### Connect 명령어

자동 생성 및 자동 시작 기능을 갖춘 컨테이너 접속 명령어입니다.

사용법:
```bash
dockit connect [옵션]
```

옵션:
- (인자 없음): 사용법 정보 표시
- `number`: 목록에서 지정된 번호의 컨테이너에 접속
- `"this"`: 현재 프로젝트 디렉토리의 컨테이너에 접속

**자동 생성 및 자동 시작 기능:**

1. **컨테이너가 존재하지 않는 경우:**
   - "컨테이너가 존재하지 않습니다. 컨테이너를 생성하고 시작한 후 접속하시겠습니까? (Y/n)"
   - 'Y'를 선택하면 자동으로 `dockit up`을 실행하여 컨테이너를 생성하고 시작한 후 접속합니다
   - 'n'을 선택하면 작업이 취소됩니다

2. **컨테이너가 중지된 경우:**
   - "컨테이너가 중지되어 있습니다. 컨테이너를 시작한 후 접속하시겠습니까? (Y/n)"
   - 'Y'를 선택하면 컨테이너를 시작한 후 접속합니다
   - 'n'을 선택하면 작업이 취소됩니다

3. **컨테이너가 실행 중인 경우:**
   - 즉시 컨테이너에 접속합니다

예제:
```bash
dockit connect         # 사용법 정보 표시
dockit connect 1       # 1번 컨테이너에 접속 (필요시 생성/시작)
dockit connect this    # 현재 프로젝트 컨테이너에 접속 (필요시 생성/시작)
```

이 명령어는 컨테이너의 현재 상태에 관계없이 단일 명령으로 어떤 컨테이너든 접속할 수 있는 원활한 워크플로우를 제공합니다.

### status - 상태 확인

컨테이너의 현재 상태를 확인합니다.

```bash
dockit status
```

이 명령어는 다음 정보를 표시합니다:

- **프로젝트 설정 정보**:
  - Dockit 버전
  - 이미지 이름
  - 컨테이너 이름

- **호스트 사용자 설정**:
  - 사용자 이름
  - 사용자 UID
  - 사용자 GID
  - 작업 디렉토리

- **컨테이너 사용자 정보**:
  - 컨테이너 사용자 이름
  - 컨테이너 사용자 UID
  - 컨테이너 사용자 GID

- **컨테이너 상태** (컨테이너가 있는 경우):
  - 컨테이너 ID
  - 실행 상태
  - 생성 시간
  - 이미지 정보
  - IP 주소 (실행 중인 경우)
  - 포트 정보 (실행 중인 경우)

호스트 사용자 설정과 컨테이너 사용자 정보가 항상 구분되어 표시되므로, 권한 문제를 진단할 때 특히 유용합니다. 컨테이너가 아직 생성되지 않은 경우에도 호스트 설정은 확인할 수 있습니다.

### migrate - 버전 업그레이드

Dockit을 새 버전으로 업그레이드하면서 사용자 설정을 보존합니다.

```bash
dockit migrate
```

이 명령어는 다음 작업을 수행합니다:
- 현재 설정의 백업 생성
- 새 버전 환경 초기화
- 사용자 설정을 새 버전으로 마이그레이션
- 사용자 지정 설정 보존

마이그레이션 과정은 안전하게 설계되어 있으며, 실패 시 자동 롤백 기능이 포함되어 있습니다.

### setup - 전체 환경 설정

초기화, 빌드, 시작, 접속을 한번에 실행합니다.

```bash
dockit setup
```

이 명령어는 다음 작업을 순차적으로 수행하여 간소화된 프로세스를 제공합니다:
- Docker 개발 환경 초기화 (`init` 명령어와 동일)
- Docker 이미지 빌드 (`build` 명령어와 동일)
- 컨테이너 시작 (`up` 명령어와 동일)
- 컨테이너 접속 (`connect` 명령어와 동일)

각 단계마다 진행 여부를 확인하는 프롬프트가 표시되므로, 원하는 시점에 중단할 수 있습니다. 이 명령어는 단일 명령으로 전체 환경을 설정하면서도 각 단계를 제어하고 싶은 사용자에게 이상적입니다.

### run - 자동 실행

초기화, 빌드, 시작을 자동으로 한 번에 실행합니다.

```bash
dockit run
```

이 명령어는 사용자 확인 프롬프트 없이 다음 작업을 순차적으로 수행합니다:
- Docker 개발 환경 초기화 (`init` 명령어와 동일)
- Docker 이미지 빌드 (`build` 명령어와 동일)
- 컨테이너 백그라운드에서 시작 (`up` 명령어와 동일)

`setup` 명령어가 각 단계마다 사용자 확인을 요구하는 것과 달리, `run` 명령어는 모든 작업을 자동으로 연속해서 실행합니다. 이는 스크립트나 중단 없이 모든 작업을 수행하고 싶은 상황에 이상적입니다.

### join - 자동 실행 및 접속

초기화, 빌드, 시작, 접속을 자동으로 한 번에 실행합니다.

```bash
dockit join
```

이 명령어는 다음 작업을 순차적으로 수행합니다:
- Docker 개발 환경 초기화 (`init` 명령어와 동일)
- Docker 이미지 빌드 (`build` 명령어와 동일)
- 컨테이너 시작 (`up` 명령어와 동일)
- 컨테이너에 즉시 접속 (`connect` 명령어와 동일)

`join` 명령어는 `run`과 `connect` 명령어의 기능을 결합하여, 초기화부터 대화형 쉘까지의 전체 워크플로우를 제공합니다. 단일 명령으로 개발 환경에서 바로 작업을 시작하고 싶을 때 완벽한 옵션입니다.

### ps - 컨테이너 목록

dockit으로 생성된 모든 컨테이너(실행 중 및 정지)를 나열합니다.

```bash
dockit ps
```

이 명령어는 dockit으로 생성된 모든 컨테이너에 대해 다음 정보를 표시합니다:
- 컨테이너 ID (12자리)
- 이미지 이름
- 컨테이너 이름 (간소화된 형태로 표시)
- 생성 날짜 및 시간
- 상태 (실행 중 또는 정지됨, 색상으로 구분)
- IP 주소 (실행 중인 컨테이너의 경우)
- 노출된 포트 (실행 중인 컨테이너의 경우)

컨테이너 이름은 가독성을 높이기 위해 간소화된 형태로 표시됩니다:
- 'dockit-' 접두사가 제거됩니다
- 전체 경로 대신 의미 있는 마지막 디렉토리 이름을 표시합니다
  - 예: 'dockit-home-hgs-dockit-test-temp-b' → 'temp-b'

이 기능은 여러 개의 dockit 환경을 관리할 때 매우 유용하며, 특히 여러 프로젝트에서 생성된 컨테이너들을 한눈에 구분하고 상태를 파악할 수 있습니다.

### help - 도움말

도움말 정보를 표시합니다.

```bash
dockit help
```

## 설정 파일

Dockit은 `.dockit_project/.env` 파일에 모든 설정을 저장합니다. 이 파일은 초기화 과정에서 생성되며, 다음과 같은 정보를 포함합니다:

```
# Docker Tools Configuration File
# Docker Tools 설정 파일
# Auto-generated: [날짜]
# 자동 생성됨: [날짜]

# Container Settings
# 컨테이너 설정
IMAGE_NAME="[이미지 이름]"
CONTAINER_NAME="[컨테이너 이름]"

# User Settings
# 사용자 설정
USERNAME="[사용자 이름]"
USER_UID="[UID]"
USER_GID="[GID]"
USER_PASSWORD="[비밀번호]"
WORKDIR="[작업 디렉토리]"
```

이 파일은 필요에 따라 수동으로 편집할 수 있습니다.

## 문제 해결

### 초기화 문제

**문제**: 초기화가 실패하는 경우
**해결책**: 
- Docker가 실행 중인지 확인하세요.
- 필요한 권한이 있는지 확인하세요.
- `.dockit_project` 디렉토리를 삭제하고 다시 시도하세요.

### 컨테이너 시작 문제

**문제**: 컨테이너가 시작되지 않는 경우
**해결책**:
- 포트 충돌이 없는지 확인하세요.
- Docker 서비스가 실행 중인지 확인하세요.
- Docker 이미지가 존재하는지 확인하세요.

### 컨테이너 접속 문제

**문제**: 컨테이너에 접속할 수 없는 경우
**해결책**:
- 컨테이너가 실행 중인지 확인하세요.
- 컨테이너 이름이 올바른지 확인하세요.

### 컨테이너 사용자 이름 문제

**문제**: 설정한 사용자 이름(USERNAME)과 컨테이너 내부 사용자 이름이 다른 경우
**해결책**:
- 이는 정상적인 현상입니다. `dockit status` 명령으로 확인할 수 있는 컨테이너 사용자 정보는 베이스 이미지에 이미 존재하는 사용자를 사용하는 경우 다를 수 있습니다.
- 중요한 것은 UID와 GID가 일치하는지 여부입니다. 파일 시스템 권한은 이름이 아닌, UID/GID에 의해 결정됩니다.
- 파일 권한 문제가 발생하면 `dockit status`로 컨테이너 사용자의 UID/GID가 호스트 시스템의 사용자 UID/GID와 일치하는지 확인하세요. 