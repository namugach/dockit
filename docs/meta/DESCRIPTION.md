# Dockit - 도커 개발 환경 프로젝트 소개

## 프로젝트 개요

Dockit은 개발자들이 Docker 기반 개발 환경을 빠르고 쉽게 설정할 수 있도록 하는 모듈식 쉘 스크립트 도구입니다. 이 프로젝트는 컨테이너 기반 개발 환경을 표준화하고, 설정 과정을 간소화하여 개발자들이 개발에 집중할 수 있도록 돕는 것을 목표로 합니다.

## 주요 특징

### 1. 모듈식 아키텍처

Dockit은 다음과 같은 독립적인 모듈로 구성되어 있습니다:

#### 핵심 모듈
- **common**: 공통 유틸리티 함수 및 변수
- **init**: 초기 설정 및 프로젝트 환경 구성
- **build**: Docker 이미지 빌드 관리
- **start**: 컨테이너 시작 관리
- **up**: 컨테이너 백그라운드 시작 관리
- **stop**: 컨테이너 정지 관리 (상태 보존)
- **down**: 컨테이너 완전 제거 관리
- **connect**: 실행 중인 컨테이너에 쉽게 접속
- **status**: 컨테이너 및 이미지 상태 확인
- **help**: 도움말 및 사용법 안내

#### 편의 기능 모듈
- **run**: 상호작용 없이 자동으로 초기화, 빌드, 시작을 수행
- **setup**: 초기화, 빌드, 시작, 접속을 한 번에 수행
- **list**: dockit으로 생성된 모든 컨테이너 목록 조회
- **base**: 베이스 이미지 관리 (list, ls, set, add, remove, validate, reset)
- **ps**: 컨테이너 프로세스 상태 확인
- **registry**: 컨테이너 레지스트리 관리
- **migrate**: 새 버전으로 업그레이드
- **container_base**: 컨테이너 기본 기능 제공

이러한 모듈식 설계는 코드 유지보수와 확장을 용이하게 합니다.

### 2. 깔끔한 파일 구조

Dockit은 코드 구조의 명확성과 유지보수성을 높이기 위해 다음과 같은 디렉토리 구조를 채택했습니다:

- **src**: 모든 소스 코드가 포함된 디렉토리
  - **modules**: 기능별로 분리된 쉘 스크립트 모듈
  - **templates**: Docker 이미지 및 Compose 파일 템플릿
  - **utils**: 공통 유틸리티 함수들 (로깅, 파일 처리, 시스템 유틸리티 등)
  - **completion**: 자동완성 시스템 (bash, zsh 지원)
  - **dev**: 개발 및 테스트 도구들
- **bin**: 설치/제거 스크립트 및 버전 정보
- **docs**: 다국어 문서 및 프로젝트 메타데이터
- **config**: 설정 파일들
- **.dockit_project**: 모든 생성 파일을 한 곳에서 관리하는 디렉토리

이러한 구조는 다음과 같은 이점을 제공합니다:
- 프로젝트 루트 디렉토리가 깔끔하게 유지됨
- 소스 코드(src)와 생성 파일(.dockit_project)이 명확히 분리됨
- 기능별로 체계적으로 분류된 모듈 구조
- 개발 도구와 유틸리티의 명확한 분리
- 버전 관리 시스템에서 생성 파일을 쉽게 제외할 수 있음
- 표준적인 프로젝트 구조를 따라 이해하기 쉬움

### 3. 사용자 친화적 인터페이스

- 대화형 설치 과정으로 사용자가 쉽게 설정을 커스터마이즈할 수 있음
- 컬러 출력으로 중요한 정보를 강조하여 가독성 향상
- 자세한 로깅으로 문제 해결이 용이함
- bash 및 zsh 자동완성 지원으로 명령어 입력 편의성 향상
- 개발자를 위한 디버깅 및 테스트 도구 제공
- **디렉터리 이름 검증 및 자동 변경**: Docker 이미지 이름 규칙에 맞지 않는 대문자 포함 디렉터리명 자동 감지 및 변환 제안

### 4. 컨테이너-호스트 권한 문제 해결

개발 컨테이너에서 발생하는 일반적인 문제 중 하나는 파일 권한 관리입니다. Dockit은:

- 호스트 사용자의 UID/GID를 컨테이너 내부 사용자에게 적용
- **UID 충돌 자동 감지**: 베이스 이미지에 동일한 UID를 가진 사용자가 존재하는 경우 자동 감지
- **스마트 비밀번호 할당**: 실제 컨테이너 사용자(예: ubuntu)에게 자동으로 비밀번호 설정
- **조건부 사용자 처리**: 기존 사용자 활용 vs 새 사용자 생성을 자동으로 결정
- **Docker 캐싱 제어**: `--no-cache` 옵션으로 변경사항이 제대로 반영되도록 지원
- 볼륨 마운트 시 권한 문제를 자동으로 해결하는 메커니즘 제공
- 볼륨 마운트를 통해 호스트와 컨테이너 간 원활한 파일 공유 지원

**새로운 v1.2.0 기능:**
- `getent passwd ${USER_UID}`를 통한 UID 기반 사용자 확인
- `usermod + openssl passwd + passwd -u` 조합으로 안전한 비밀번호 설정
- 사용자 커스터마이징 가능한 Dockerfile (`.dockit_project/Dockerfile` 직접 수정 지원)

### 5. 직관적인 컨테이너 관리 명령어

Dockit은 컨테이너 관리를 위한 명확하게 구분된 명령어를 제공합니다:

#### 기본 관리 명령어
- **init**: 개발 환경을 초기화하고 설정합니다.
- **build**: Docker 이미지를 빌드합니다.
- **start**: 컨테이너를 시작합니다. 컨테이너가 없으면 새로 생성합니다.
- **up**: 컨테이너를 백그라운드에서 시작합니다.
- **stop**: 컨테이너를 정지만 하고 상태는 유지합니다. 나중에 `start`로 다시 시작할 수 있습니다.
- **down**: 컨테이너를 완전히 제거합니다. 컨테이너 내부의 모든 데이터가 삭제됩니다.
- **connect**: 실행 중인 컨테이너에 접속합니다.
- **status**: 컨테이너의 현재 상태를 확인하고 다음에 수행할 수 있는 명령어를 안내합니다.

#### 편의 명령어
- **run**: 상호작용 없이 자동으로 초기화, 빌드, 시작을 수행합니다.
- **setup**: 초기화, 빌드, 시작, 접속을 한 번에 수행합니다.
- **list**: dockit으로 생성된 모든 컨테이너 목록을 조회합니다.
- **base**: 베이스 이미지 관리 (목록 보기, 설정, 추가, 제거, 검증, 초기화) 및 번호 기반 선택을 지원합니다.
- **ps**: 컨테이너 프로세스 상태를 확인합니다.

#### 고급 기능
- **registry**: 컨테이너 레지스트리를 관리합니다.
- **migrate**: 새 버전으로 업그레이드합니다.

모든 명령어는 번호, "this", "all" 옵션을 지원하여 여러 컨테이너를 효율적으로 관리할 수 있습니다.

이 구분된 명령어 체계는 사용자의 의도에 맞는 정확한 동작을 수행하여 실수를 방지합니다.

## 기술적 구현

### 설정 파일 관리

Dockit은 `.dockit_project/.env` 파일에 모든 설정을 저장합니다. 이 파일은:

1. 최초 설치 시 사용자 입력을 통해 생성됨
2. 후속 실행 시 자동으로 로드됨
3. 언제든지 수동으로 편집 가능함

### 도커 이미지 템플릿

기본 Dockerfile 템플릿은 다음 기능을 제공합니다:

- 사용자 생성 및 sudo 권한 설정
- 한국어 로케일 지원
- 개발 도구 및 유틸리티 설치
- 작업 디렉토리 구성 및 권한 설정

### 자동완성 시스템

Dockit은 bash와 zsh 모두에서 자동완성을 지원합니다:

- **bash 자동완성**: `src/completion/bash.sh`에서 구현
- **zsh 자동완성**: `src/completion/zsh.sh`에서 구현
- **공통 로직**: `src/completion/completion-common.sh`에서 명령어 및 옵션 처리
- 설치 시 자동으로 쉘 설정에 추가됨

### 유틸리티 시스템

확장된 유틸리티 시스템으로 코드 재사용성과 유지보수성을 향상시켰습니다:

- **로깅 시스템** (`src/utils/log.sh`): 구조화된 로그 출력 및 관리
- **파일 처리** (`src/utils/file.sh`): 파일 및 디렉토리 조작 유틸리티
- **시스템 유틸리티** (`src/utils/system.sh`): 시스템 정보 및 환경 관리
- **비동기 작업** (`src/utils/async_tasks.sh`): 백그라운드 작업 처리
- **범용 유틸리티** (`src/utils/utils.sh`): 공통 헬퍼 함수들

### 개발 및 테스트 도구

개발자를 위한 포괄적인 테스트 및 디버깅 도구를 제공합니다:

- **모듈 테스트**: 개별 모듈의 기능 검증
- **상태 테스트**: 컨테이너 상태 관리 검증
- **설정 테스트**: 환경 설정 검증
- **마이그레이션 테스트**: 버전 업그레이드 검증
- **디버깅 도구**: 문제 진단 및 해결 지원

### 컨테이너 레지스트리 관리

Dockit으로 생성된 모든 컨테이너를 중앙에서 관리합니다:

- 컨테이너 목록 자동 추적
- 프로젝트별 컨테이너 그룹화
- 일괄 작업 지원 (start all, stop all 등)

### 마이그레이션 지원

기존 버전에서 새 버전으로의 마이그레이션을 자동화했습니다:

- 이전 버전의 설정 파일 자동 감지 및 새 위치로 이동
- 오래된 로그 파일 정리
- 이전 참조명(docker-tools)을 새 이름(dockit)으로 변경
- 설정 파일 형식 업그레이드

## 사용 사례

Dockit은 다음과 같은 상황에서 특히 유용합니다:

1. 팀 프로젝트에서 모든 개발자가 동일한 개발 환경을 사용해야 할 때
2. 로컬 환경 설정을 복잡하게 하지 않고 프로젝트별 의존성을 관리하고 싶을 때
3. 리눅스, macOS, Windows(WSL) 등 서로 다른 운영체제에서 일관된 개발 환경이 필요할 때
4. Docker를 사용하지만 docker-compose 명령어를 매번 입력하기 번거로울 때

## 향후 개발 계획

앞으로 계획하고 있는 기능 및 개선 사항:

1. **템플릿 확장**: 다양한 개발 환경을 위한 추가 템플릿 제공 (Node.js, Python, Java, Go 등)
2. **네트워킹 기능**: 네트워크 포트 설정 및 컨테이너 간 통신을 위한 편의 기능 추가
3. **GUI 도구**: 웹 기반 또는 데스크톱 GUI 관리 도구 개발 검토
4. **고급 관리 기능**: 
   - 컨테이너 업데이트 및 재빌드 명령 추가
   - 볼륨 백업 및 복원 기능
   - 컨테이너 성능 모니터링
5. **클라우드 통합**: Docker Hub, AWS ECR 등 클라우드 레지스트리 연동
6. **플러그인 시스템**: 사용자 정의 확장 기능 지원
7. **CI/CD 통합**: GitHub Actions, GitLab CI 등과의 연동 템플릿 제공

## 결론

Dockit은 Docker의 강력함과 쉬운 사용성을 결합한 도구로, 개발자들이 복잡한 Docker 설정에 시간을 낭비하지 않고 빠르게 개발을 시작할 수 있도록 도와줍니다. 모듈식 설계와 깔끔한 파일 구조 덕분에 유지보수가 용이하고, 필요에 따라 쉽게 확장할 수 있습니다. 