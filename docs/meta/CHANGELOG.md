# Changelog

모든 주요 변경 사항이 이 파일에 기록됩니다.

## [1.4.3] - 2025-06-02

### 주요 기능 추가
- **동적 사용자 검출 시스템**
  - `ACTUAL_USER` 환경변수를 통한 베이스 이미지의 실제 사용자 자동 감지
  - `detect_actual_user()` 함수로 UID 1000 사용자의 실제 이름 검출 (예: ubuntu, hgs)
  - 베이스 이미지가 없거나 pull 실패 시 안전한 fallback 처리
  - Docker 명령어 사용 불가 시에도 안전한 동작 보장

- **실시간 호스트 파일 동기화**
  - 호스트 `.ssh` 디렉토리를 컨테이너에 직접 볼륨 마운트
  - 호스트 `.gitconfig` 파일을 컨테이너에 직접 볼륨 마운트  
  - 호스트에서 SSH 키나 Git 설정 변경 시 컨테이너에 즉시 반영
  - 파일 복사 오버헤드 없이 실시간 동기화 구현

### 아키텍처 개선
- **docker-compose.yml 템플릿 최적화**
  - `${USERNAME}` 대신 `${ACTUAL_USER}` 사용으로 정확한 경로 매핑
  - `~/.gitconfig:/home/${ACTUAL_USER}/.gitconfig:ro` 볼륨 마운트
  - `~/.ssh:/home/${ACTUAL_USER}/.ssh:ro` 볼륨 마운트
  - 읽기 전용 마운트로 호스트 파일 보호

- **Dockerfile 템플릿 간소화**
  - 불필요한 SSH 디렉토리 생성 로직 제거
  - 호스트 파일 복사 관련 entrypoint 스크립트 로직 제거
  - 볼륨 마운트 방식으로 단순화된 컨테이너 구조
  - 빌드 시간 단축 및 이미지 크기 최적화

### 기술적 향상
- **베이스 이미지 호환성 강화**
  - ubuntu, alpine, centos 등 다양한 베이스 이미지 지원
  - 베이스 이미지의 기존 사용자와 호스트 사용자 간 자동 매핑
  - UID 충돌 시나리오에서 올바른 사용자 경로 선택

- **환경변수 로드 시스템 개선**
  - `load_env()` 함수에서 자동으로 실제 사용자 검출
  - 베이스 이미지 pull 및 검사 자동화
  - 검출 과정의 상세한 로깅 및 상태 보고

### 사용자 경험 향상
- **투명한 파일 액세스**
  - 컨테이너 내에서 호스트와 동일한 SSH 키 및 Git 설정 사용
  - 별도 설정 없이 즉시 사용 가능한 개발 환경
  - 호스트와 컨테이너 간 일관된 인증 정보

- **자동화된 설정 관리**
  - 수동 파일 복사나 권한 설정 불필요
  - 베이스 이미지 변경 시에도 자동 적응
  - 사용자 개입 없는 원활한 환경 구성

## [1.4.2] - 2025-06-02

### 개선됨
- **join 명령어 완전 자동화**
  - `dockit join` 실행 시 사용자 상호작용 없이 완전 자동 처리
  - 자동 모드(`DOCKIT_AUTO_MODE=true`) 환경 변수를 통한 자동화 구현
  - 컨테이너 생성, 시작, 접속 과정이 seamless하게 연결됨

- **run 모듈 안정성 향상**
  - `build_main` 함수에 "this" 인자 자동 전달로 현재 프로젝트 빌드 보장
  - `up_main` 함수에 "this" 인자 자동 전달로 현재 프로젝트 시작 보장
  - 빌드와 컨테이너 시작 과정에서 발생하던 무시 문제 해결

- **up 모듈 사용자 경험 개선**
  - 이미지가 존재하지 않을 때 자동으로 빌드 제안 기능 추가
  - 자동 모드에서는 이미지 빌드가 자동으로 수행됨
  - 수동 모드에서는 사용자에게 빌드 여부를 확인 후 진행

### 다국어화 완성
- **connect 모듈 완전 다국어화**
  - 기존 하드코딩된 한국어 메시지 11개를 다국어 메시지 변수로 교체
  - 자동 모드 관련 메시지 (`MSG_CONNECT_AUTO_CREATING`, `MSG_CONNECT_AUTO_STARTING`)
  - 프로젝트 및 레지스트리 관련 메시지 완전 다국어화
  - 향후 영어 등 다국어 지원 기반 완성

### 수정됨
- **join 워크플로우 안정성 확보**
  - `join.sh`에서 불필요한 `read` 함수 오버라이드 제거
  - 환경 변수 기반 자동화로 더 안전하고 예측 가능한 동작
  - 각 단계별 성공/실패 로깅 개선

- **모듈 간 통신 개선**
  - `run.sh` → `build.sh`, `up.sh` 호출 시 올바른 인자 전달
  - `connect.sh`에서 자동/수동 모드 구분 처리 로직 개선
  - 레지스트리 상태 업데이트 일관성 보장

## [1.4.1] - 2025-06-01

### 개선됨
- **문서 일관성 및 사용자 경험 향상**
  - 영어/한국어 메뉴얼의 명령어 순서 동기화 (`ls`를 `list` 바로 다음으로 이동)
  - `dockit image` 도움말에 `ls` 별칭 명시적 표시 추가
  - 한국어/영어 메시지 파일에서 image 모듈 `list, ls` 명령어 설명 통합
  - 사용자가 `ls` 별칭 존재를 쉽게 확인할 수 있도록 개선

### 수정됨
- **도움말 정보 완성도 향상**
  - `dockit image` 명령어 실행 시 `ls` 별칭이 누락되던 문제 해결
  - 영어와 한국어 버전 간 명령어 순서 불일치 문제 해결
  - 메뉴얼 문서의 목차와 본문 순서 일치성 확보

## [1.4.0] - 2025-05-31

### 주요 기능 추가
- **종합적인 Docker 이미지 관리 시스템**
  - `dockit image` 명령어 모듈 새로 추가
  - 4개의 하위 명령어로 완전한 이미지 라이프사이클 관리
    - `list`: dockit 이미지 목록을 표 형태로 표시 (NO, ID, CREATED, SIZE, NAME)
    - `remove`: 특정 이미지를 이름 또는 번호로 안전하게 제거
    - `prune`: 사용하지 않는 이미지들을 자동으로 찾아 정리
    - `clean`: 모든 dockit 이미지와 관련 컨테이너를 완전 제거

- **강화된 안전 장치**
  - dockit 접두사 이미지만 대상으로 하여 시스템 이미지 보호
  - 이미지 사용 중인 컨테이너 자동 감지 및 경고
  - 2단계 안전 확인 과정 (`clean` 명령어의 경우)
  - 상세한 분석 정보 제공 (사용 현황, 예상 절약 공간 등)

- **자동 완성 시스템 확장**
  - bash 및 zsh에서 `dockit image` 하위 명령어 자동 완성 지원
  - 각 하위 명령어에 대한 설명 표시
  - 다국어 자동완성 메시지 지원 (한국어/영어)

### 다국어화 및 사용자 경험 개선
- **완전한 다국어화 구현**
  - 모든 image 모듈 메시지를 외부 설정 파일로 분리
  - 33개의 새로운 image 관련 메시지 변수 추가
  - `get_message` 함수를 통한 언어별 메시지 자동 선택
  - 한국어와 영어 완전 지원

- **시각적 진행 상황 표시**
  - 각 단계별 아이콘으로 진행 상황 표시 (✓/✗/⚠️)
  - 색상 코딩으로 성공/실패/경고 상태 구분
  - 실시간 처리 결과 표시

### 기술적 구현 및 테스트
- **체계적인 테스트 시스템**
  - 11단계 포괄적 자동화 테스트 구현 (`test/container/image/test.sh`)
  - 빈 상태, 빌드, 제거, 정리 등 모든 시나리오 검증
  - 취소 동작 및 에지 케이스 테스트 포함
  - 기존 테스트 프레임워크와 완전 통합

- **정교한 상태 분석 로직**
  - 컨테이너 종속성 자동 분석
  - 이미지별 사용 상태 추적 (사용 중/사용 안함)
  - 총 이미지 수, 사용률, 예상 절약 공간 자동 계산

### 모듈 설계 및 아키텍처
- **확장 가능한 모듈 구조**
  - 기존 dockit 패턴과 일관된 설계
  - `src/modules/image.sh`로 독립적인 모듈 구현
  - 메인 dockit 스크립트와 완전 통합
  - 향후 기능 확장을 위한 확장성 확보

- **메시지 시스템 통합**
  - `config/messages/en.sh` 및 `config/messages/ko.sh` 확장
  - 기존 메시지 시스템과 완전 호환
  - 일관된 메시지 패턴 및 네이밍 컨벤션 적용

### 문서화 및 사용자 가이드
- **포괄적인 문서 업데이트**
  - 한국어/영어 메뉴얼에 image 모듈 상세 설명 추가
  - README 파일에 새로운 기능 소개
  - 사용 시나리오별 예시 코드 제공
  - 안전 장치 및 주의사항 상세 설명

## [1.3.0] - 2025-05-31

### 주요 기능 추가
- **실시간 Docker 상태 동기화**
  - `dockit list` 실행 시 레지스트리 상태와 실제 Docker 상태 자동 동기화
  - 외부에서 Docker 이미지/컨테이너 변경 시 자동 감지 및 상태 업데이트
  - `get_actual_docker_state` 함수로 정확한 프로젝트 상태 판단
  - 수동 `error` 상태는 보존하면서 다른 상태는 실시간 반영

- **이미지 재사용 기능**
  - `dockit init` 시 다른 프로젝트의 이미지 재사용 옵션 (`l - 이미지 재사용`) 추가
  - 절대 경로 입력으로 기존 프로젝트 이미지 활용 가능
  - 자원 효율적인 개발 환경 구성 지원
  - 이미지 존재 여부 자동 검증 및 안전한 재사용 처리

- **확장된 프로젝트 상태 시스템**
  - `none`: 초기화 후 빌드 전 상태
  - `ready`: 이미지 빌드 완료 상태  
  - `error`: 빌드 실패 상태
  - 기존 `running`, `stopped`, `down` 상태와 함께 완전한 라이프사이클 관리

### 다국어화 및 메시지 개선
- **build 모듈 완전 다국어화**
  - 모든 하드코딩된 한국어 메시지를 메시지 변수로 교체
  - 33개의 새로운 build 관련 메시지 변수 추가
  - `show_usage`, 에러 처리, 스피너 메시지 완전 다국어화
  - 향후 영어 등 다국어 지원 기반 마련

- **메시지 시스템 통합 개선**
  - `get_message` 함수를 통한 일관된 메시지 처리
  - 빌드 과정 중 상태 변경 메시지 명확화
  - 사용자 경험 개선을 위한 메시지 내용 최적화

### 성능 및 안정성 향상
- **병렬 빌드 처리**
  - `dockit build all` 명령어 시 비동기 병렬 빌드 지원
  - 개별 프로젝트 빌드 실패가 다른 프로젝트에 영향 주지 않도록 개선
  - 백그라운드 작업 진행 상황 실시간 표시

- **컨테이너 관리 로직 개선**
  - 빌드 시 기존 컨테이너 자동 정지 및 제거
  - 상태 전환 로직 최적화 (build → ready, 실패 → error)
  - Docker 명령어 실행 안정성 향상

### 기술적 개선사항
- **색상 시스템 중앙화 (DRY 원칙 적용)**
  - 새로운 `src/utils/colors.sh` 파일로 모든 색상 정의 통합
  - 4개 파일에서 중복된 색상 정의 제거 (`install.sh`, `log.sh`, `core.sh`, `list.sh`)
  - `export` 를 통한 하위 스크립트 색상 변수 공유
  - 유지보수성 향상 및 일관된 색상 관리 시스템 구축

- **경로 처리 함수 개선**
  - `to_flat_path` 함수에서 존재하지 않는 경로 안전 처리
  - `generate_dockit_name` 함수 최적화
  - 절대 경로 변환 및 이름 생성 로직 안정화

- **레지스트리 시스템 강화**
  - 프로젝트 ID 동기화 로직 개선
  - 유효하지 않은 프로젝트 자동 정리 기능
  - 레지스트리 무결성 검사 및 복구 기능

### 버그 수정
- Dockerfile 존재 여부 확인 로직 개선
- 컨테이너 이름 표시 포맷 문제 수정 (`%s:` 오류 해결)
- 이미지 이름 생성 시 중복 접두사 문제 해결
- 빌드 실패 시 적절한 에러 상태 전환 보장

## [1.2.0] - 2025-05-29

### 추가됨
- **UID 충돌 감지 및 조건부 사용자 처리**
  - Dockerfile 템플릿에서 기존 사용자(예: ubuntu) 존재 시 자동 감지
  - 호스트 UID와 동일한 컨테이너 사용자에게 자동 비밀번호 설정
  - `getent passwd ${USER_UID}` 를 통한 UID 기반 사용자 확인
  - `usermod + openssl passwd + passwd -u` 조합으로 안전한 비밀번호 설정
- **build 명령어 --no-cache 옵션**
  - `dockit build --no-cache` 옵션 추가
  - Docker 이미지 캐싱 문제 해결
  - 강제 리빌드 지원
- **사용자 Dockerfile 커스터마이징 지원**
  - `.dockit_project/Dockerfile` 직접 사용으로 변경
  - 사용자가 생성된 Dockerfile을 수정 가능
  - 수정 사항이 빌드에 즉시 반영

### 개선됨
- **build 모듈 아키텍처 개선**
  - 템플릿에서 임시 파일 생성 방식 제거
  - init에서 생성한 `.dockit_project/Dockerfile` 직접 활용
  - 더 직관적이고 예측 가능한 빌드 프로세스
- **베이스 이미지 호환성 향상**
  - 다양한 베이스 이미지의 기존 사용자와 호환
  - UID 충돌 시나리오에 대한 자동 처리
  - 더 안정적인 사용자 권한 관리

### 수정됨
- **UID 충돌로 인한 비밀번호 설정 실패 문제 해결**
  - 호스트 사용자명(예: hgs)에 비밀번호 설정 시도 시 실패하던 문제
  - 실제 컨테이너 사용자(예: ubuntu)에게 비밀번호 설정되도록 수정
  - sudo 권한 정상 동작 확인
- **Docker 캐싱으로 인한 Dockerfile 수정사항 미반영 문제 해결**
  - --no-cache 옵션으로 강제 리빌드 지원
  - 템플릿 수정사항이 확실히 반영되도록 개선

## [1.1.0] - 2025-05-28

### 추가됨
- 새로운 명령어들
  - `up`: 컨테이너를 백그라운드에서 시작 (번호, "this", "all" 옵션 지원)
  - `run`: 상호작용 없이 자동으로 초기화, 빌드, 시작을 수행
  - `join`: 초기화, 빌드, 시작, 접속을 한 번에 수행
  - `list`: dockit으로 생성된 모든 컨테이너 목록 조회
  - `ps`: 컨테이너 프로세스 상태 확인
  - `registry`: 컨테이너 레지스트리 관리
  - `migrate`: 새 버전으로 업그레이드
  - `build`: 개발 환경용 Docker 이미지 빌드
- 자동완성 시스템 구현
  - bash 자동완성 지원 (`src/completion/bash.sh`)
  - zsh 자동완성 지원 (`src/completion/zsh.sh`)
  - 공통 자동완성 로직 (`src/completion/completion-common.sh`)
- 유틸리티 시스템 확장
  - 로깅 시스템 (`src/utils/log.sh`)
  - 비동기 작업 처리 (`src/utils/async_tasks.sh`)
  - 시스템 유틸리티 (`src/utils/system.sh`)
  - 파일 처리 유틸리티 (`src/utils/file.sh`)
  - 범용 유틸리티 (`src/utils/utils.sh`)
- 개발 및 테스트 도구
  - 모듈 테스트 도구 (`src/dev/module_test.sh`)
  - 상태 테스트 도구 (`src/dev/status_test.sh`)
  - 설정 테스트 도구 (`src/dev/config_test.sh`)
  - 마이그레이션 테스트 도구 (`src/dev/migrate_test.sh`)
  - 디버깅 도구 (`src/dev/debug.sh`)
- 컨테이너 베이스 모듈 (`src/modules/container_base.sh`)

### 개선됨
- 모듈식 아키텍처 강화로 코드 재사용성 향상
- 명령어 옵션 시스템 확장 (번호, "this", "all" 옵션)
- 오류 처리 및 로깅 시스템 개선
- 프로젝트 구조 최적화

### 수정됨
- 초기화 중단 시 `.dockit_project` 디렉토리 잔존 문제 해결
- 로그 권한 관련 문제 수정
- 레지스트리 중복 등록 문제 해결

## [1.0.0] - 2023-04-13

### 추가됨
- 다국어 메시지 시스템 구현 (한국어/영어 지원)
- Docker 개발 환경 초기화 및 관리 기능
- 컨테이너 시작, 정지, 제거 명령어
- 컨테이너 접속 및 상태 확인 기능
- 사용자 설정에 맞는 Docker 이미지 자동 빌드 기능
- 시스템 전역 설치 및 제거 스크립트
- 완전한 문서화 (README 및 상세 메뉴얼)

### 변경됨
- 프로젝트 구조 개선 및 모듈화
- 설정 파일들을 `.dockit_project` 디렉토리에 모아서 관리
- 오류 처리 및 로깅 시스템 향상

### 수정됨
- 초기화 중단 시 `.dockit_project` 디렉토리 잔존 문제 해결
- 명령어 실행 전 초기화 상태 확인 로직 수정
- 다국어 메시지 로드 관련 오류 수정 